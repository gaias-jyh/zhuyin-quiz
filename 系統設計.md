# 系統設計文檔

## 1. 專案概述

### 1.1 專案簡介
注音測驗系統（Zhuyin Quiz）是一個基於 Vue 3 的單頁應用程式（SPA），用於幫助用戶學習和練習注音符號輸入。系統提供互動式的測驗功能，讓用戶可以通過鍵盤輸入注音符號來回答問題。

### 1.2 技術棧
- **前端框架**: Vue 3 (Composition API)
- **建置工具**: Vite 7.2.2
- **開發語言**: JavaScript/TypeScript
- **樣式**: CSS (Scoped Styles)
- **套件管理**: npm

### 1.3 專案結構
```
zhuyin-quiz/
├── src/
│   ├── components/
│   │   ├── ZhuyinKeyboard.vue    # 注音鍵盤組件
│   │   ├── QuizView.vue           # 測驗視圖組件
│   │   ├── ResultView.vue         # 結果視圖組件
│   │   ├── StartView.vue          # 開始視圖組件
│   │   └── HelloWorld.vue         # 範例組件
│   ├── assets/
│   │   └── dictionary.csv         # 字典資料
│   ├── App.vue                    # 根組件
│   ├── main.js                    # 應用程式入口
│   └── style.css                  # 全域樣式
├── public/
├── package.json                   # 專案配置
├── vite.config.js                 # Vite 配置
└── README.md                      # 專案說明
```

## 2. 系統架構

### 2.1 整體架構
系統採用單頁應用（SPA）架構，使用 Vue 3 的組件化開發模式：

```
┌─────────────────────────────────────┐
│           App.vue (根組件)          │
│  ┌───────────────────────────────┐ │
│  │      StartView (開始頁面)     │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │   QuizView (測驗頁面)         │ │
│  │  ┌─────────────────────────┐ │ │
│  │  │  ZhuyinKeyboard (鍵盤)  │ │ │
│  │  └─────────────────────────┘ │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │   ResultView (結果頁面)       │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 2.2 組件層級關係
- **App.vue**: 應用程式根組件，管理整體狀態和路由
- **StartView**: 開始頁面，用於設定測驗參數
- **QuizView**: 測驗頁面，顯示題目並處理用戶輸入
- **ZhuyinKeyboard**: 注音鍵盤組件，提供注音符號輸入功能
- **ResultView**: 結果頁面，顯示測驗結果和分數

## 3. 核心功能模組

### 3.1 注音鍵盤模組 (ZhuyinKeyboard.vue)

#### 3.1.1 功能描述
提供完整的注音輸入鍵盤，支援兩種佈局模式：
- **動態 iOS 佈局**: 模擬 iOS 注音鍵盤的動態切換功能
- **傳統全注音佈局**: 顯示所有注音符號的傳統鍵盤

#### 3.1.2 主要功能
1. **動態鍵盤切換**
   - 子音（聲母）模式：顯示 21 個子音符號
   - 韻母/介音/聲調模式：根據輸入自動切換
   - Shift 鍵切換功能

2. **智能狀態管理**
   - 根據最後輸入的字符自動切換鍵盤狀態
   - 輸入子音後自動切換到韻母頁面
   - 輸入聲調後自動切換回子音頁面
3. **輸入處理**
   - 聲調符號輸入後自動加上空白（切換到下一個字）
   - 空白鍵代表一聲
   - 退格鍵智能處理（根據最後字符類型決定是否切換鍵盤）

4. **底部功能列**
   - 地球按鈕：在動態 iOS 和傳統全注音之間切換
   - 空白鍵：輸入一聲
   - 換行鍵：輸入換行符號

5. **移動端優化**
   - 禁用雙擊放大（touch-action: manipulation）
   - 禁用點擊高亮（-webkit-tap-highlight-color）
   - 優化按鍵尺寸以適應觸控操作

#### 3.1.3 技術實現
- 使用 Vue 3 Composition API
- 響應式狀態管理（ref, computed, watch）
- 事件發射機制（emit）與父組件通信
- 深色模式支援（通過 inject 注入）

#### 3.1.4 狀態變量
```javascript
- showConsonants: 是否顯示子音鍵盤
- isShiftActive: Shift 鍵是否啟用
- useDynamicLayout: 是否使用動態 iOS 佈局
- currentInput: 當前輸入內容（從 props 接收）
```

### 3.2 測驗模組 (QuizView.vue)

#### 3.2.1 功能描述
管理測驗流程，包括題目顯示、答案輸入、計時和評分。

#### 3.2.2 主要功能
1. **題目管理**
   - 從字典載入題目
   - 顯示當前題目和答案輸入框
   - 支援上一題/下一題導航

2. **計時功能**
   - 倒數計時器
   - 時間到自動提交

3. **答案檢查**
   - 即時檢查答案正確性
   - 扣分制評分系統（從 100 分開始扣分）

4. **鍵盤整合**
   - 整合 ZhuyinKeyboard 組件
   - 處理鍵盤輸入事件

5. **錯題修正模式 (Correction Mode)**
   - 答錯時進入強制修正模式
   - 顯示原始錯誤答案（以紅/綠色區分對錯音節）
   - 用戶必須逐個音節修正錯誤
   - 支援輕聲符號自動正規化（將開頭的輕聲移至末尾）
   - 視覺化反饋：使用圖標（✅/❌）代替文字提示
   - 修正完成後才算該題結束

6. **暫停與離開功能**
   - 暫停按鈕：暫停計時器並遮蔽題目，顯示暫停疊層
   - 離開按鈕：顯示確認對話框，確認後結束測驗（不保存進度）

7. **視覺反饋優化**
   - 計時器倒數少於 60 秒時變色（紅色）並閃爍提示
   - 答題正確/錯誤時顯示對應圖標

### 3.3 開始頁面模組 (StartView.vue)

#### 3.3.1 功能描述
測驗開始前的設定頁面，允許用戶配置測驗參數。

#### 3.3.2 主要功能
- 設定題目數量
- 設定每題分數
- 設定測驗時間
- 開始測驗按鈕
- **全螢幕模式支援**：開始測驗時自動進入全螢幕，提供沉浸式體驗

### 3.4 結果頁面模組 (ResultView.vue)

#### 3.4.1 功能描述
顯示測驗結果，包括分數、正確率等統計資訊。

#### 3.4.2 主要功能
- 顯示總分
- 顯示答對/答錯題數
- 顯示正確率
- 重新開始按鈕

## 4. 資料流程

### 4.1 測驗流程
```
開始頁面 → 設定參數 → 測驗頁面 → 輸入答案 → 檢查答案 → 結果頁面
```

### 4.2 鍵盤輸入流程
```
用戶點擊鍵盤 → handleInput → emit('input') → QuizView 接收 → 更新答案
```

### 4.3 狀態管理流程
```
currentInput 變化 → watch 監聽 → 分析最後字符 → 自動切換鍵盤狀態
```

## 5. 資料結構

### 5.1 題目資料結構
```javascript
{
  word: String,      // 中文字
  zhuyin: String,    // 注音符號
  // 其他可能的欄位
}
```

### 5.2 測驗配置
```javascript
{
  questionsCount: Number,    // 題目數量
  pointsPerQuestion: Number, // 每題分數
  timeLimit: Number         // 時間限制（秒）
}
```

### 5.3 測驗結果
```javascript
{
  score: Number,           // 總分
  totalQuestions: Number,  // 總題數
  correctAnswers: Number,  // 答對題數
  // 其他統計資訊
}
```

## 6. 鍵盤佈局設計

### 6.1 動態 iOS 佈局

#### 6.1.1 子音（聲母）佈局
```
第一排: ㄅ ㄆ ㄇ ㄈ ㄉ ㄊ ㄋ ㄌ
第二排: ㄍ ㄎ ㄏ ㄐ ㄑ ㄒ ㄓ ㄔ
第三排: ㄕ ㄖ ㄗ ㄘ ㄙ [Shift] [Backspace]
```

#### 6.1.2 韻母/介音/聲調佈局
```
第一排: ㄚ ㄛ ㄜ ㄝ ㄞ ㄟ ㄠ ㄡ
第二排: ㄢ ㄣ ㄤ ㄥ ㄦ ㄧ ㄨ ㄩ
第三排: [Shift] ˊ ˇ ˋ ˙ [Backspace]
```

### 6.2 傳統全注音佈局
```
第一排: ㄅ ㄉ ˇ ˋ ㄓ ˊ ˙ ㄚ ㄞ ㄢ ㄦ
第二排: ㄆ ㄊ ㄍ ㄐ ㄔ ㄗ ㄧ ㄛ ㄟ ㄣ
第三排: ㄇ ㄋ ㄎ ㄑ ㄕ ㄘ ㄨ ㄜ ㄠ ㄤ
第四排: ㄈ ㄌ ㄏ ㄒ ㄖ ㄙ ㄩ ㄝ ㄡ ㄥ

### 6.3 底部功能列 (所有模式通用)
```
[地球(切換佈局)] [空白鍵(一聲)] [換行]
```
```

## 7. 狀態管理機制

### 7.1 組件間通信
- **Props Down**: 父組件通過 props 傳遞資料給子組件
- **Events Up**: 子組件通過 emit 發送事件給父組件
- **Provide/Inject**: 用於深色模式等全域狀態共享

### 7.2 響應式系統
- 使用 Vue 3 的響應式 API（ref, reactive, computed）
- 使用 watch 監聽狀態變化並自動更新 UI

### 7.3 智能切換邏輯
```javascript
// 根據最後輸入的字符類型自動切換鍵盤
if (最後字符是子音) → 顯示韻母/介音/聲調
if (最後字符是韻母/介音) → 繼續顯示韻母/介音/聲調
if (最後字符是聲調) → 切回子音
```

## 8. 樣式設計

### 8.1 設計原則
- 模擬 iOS 鍵盤的外觀和行為
- 支援深色模式
- 響應式設計，適配不同螢幕尺寸
- **移動端優化**：
  - 禁用雙擊放大功能（touch-action: manipulation）
  - 禁用長按選取（user-select: none）
  - 禁用點擊高亮（-webkit-tap-highlight-color: transparent）

### 8.2 顏色方案
- **淺色模式**: 淺灰色背景 (#d1d5db)，白色按鍵
- **深色模式**: 深色背景 (#1a1a1a)，深灰色按鍵 (#3a3a3c)
- **功能鍵**: 灰色背景 (#b4b9c2)

### 8.3 按鍵樣式
- 圓角設計（border-radius: 5px）
- 陰影效果（box-shadow）
- 按壓反饋（:active 狀態）
- 禁用狀態樣式

## 9. 性能優化

### 9.1 組件優化
- 使用 computed 屬性緩存計算結果
- 使用 v-if/v-show 條件渲染
- 避免不必要的重新渲染

### 9.2 事件處理
- 使用事件修飾符（.prevent, .stop）
- 防抖處理（在需要的地方）

### 9.3 資源優化
- 使用 Vite 進行代碼分割和壓縮
- 圖片和資源優化

## 10. 擴展性設計

### 10.1 可擴展功能
- 支援更多鍵盤佈局
- 支援自定義主題
- 支援多語言
- 支援更多測驗模式

### 10.2 模組化設計
- 組件高度模組化，易於維護和擴展
- 功能分離清晰，便於測試

## 11. 開發環境

### 11.1 開發工具
- Node.js
- npm
- Vite
- Vue 3

### 11.2 開發命令
```bash
npm run dev      # 啟動開發伺服器
npm run build    # 建置生產版本
npm run preview  # 預覽生產版本
```

## 12. 未來改進方向

### 12.1 功能增強
- [ ] 添加更多測驗模式（聽音辨字、看字注音等）
- [ ] 添加學習進度追蹤
- [ ] 添加錯題本功能
- [ ] 添加統計分析功能

### 12.2 技術改進
- [ ] 遷移到 TypeScript
- [ ] 添加單元測試
- [ ] 添加 E2E 測試
- [ ] 優化打包大小

### 12.3 用戶體驗
- [ ] 添加動畫效果
- [ ] 添加音效反饋
- [ ] 改進錯誤提示
- [ ] 添加幫助文檔

## 13. 技術決策說明

### 13.1 為什麼選擇 Vue 3？
- Composition API 提供更好的邏輯復用
- 更好的 TypeScript 支援
- 更好的性能表現
- 活躍的社區和豐富的生態系統

### 13.2 為什麼選擇 Vite？
- 快速的開發伺服器啟動
- 即時模組熱更新（HMR）
- 優化的生產建置
- 原生 ES 模組支援

### 13.3 為什麼不使用狀態管理庫？
- 當前應用規模較小，Vue 3 的響應式系統已足夠
- 組件間通信通過 props 和 emit 即可滿足需求
- 避免過度工程化

## 14. 安全考量

### 14.1 輸入驗證
- 驗證用戶輸入的注音符號格式
- 防止 XSS 攻擊（Vue 自動轉義）

### 14.2 資料安全
- 所有資料處理在客戶端完成
- 不涉及敏感資料傳輸

## 15. 瀏覽器相容性

### 15.1 支援的瀏覽器
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)

### 15.2 行動裝置支援
- iOS Safari
- Android Chrome
- 響應式設計適配各種螢幕尺寸

## 16. 維護指南

### 16.1 代碼規範
- 使用 ESLint 進行代碼檢查
- 遵循 Vue 3 官方風格指南
- 組件命名使用 PascalCase
- 檔案命名使用 PascalCase.vue

### 16.2 註釋規範
- 重要功能添加註釋說明
- 複雜邏輯添加詳細註釋
- 使用繁體中文註釋

### 16.3 版本控制
- 使用 Git 進行版本控制
- 遵循語義化版本（Semantic Versioning）
- 提交訊息清晰明確

---

**文檔版本**: 1.0  
**最後更新**: 2024  
**維護者**: 開發團隊

